<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVM s Landmarks</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }
        
        canvas {
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: crosshair;
            transition: all 0.3s ease;
        }
        
        canvas:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .control-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
            border-radius: 3px;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .value-display {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
            margin-top: 5px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }
        
        .btn-clear {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
        }
        
        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(44, 62, 80, 0.4);
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 12px;
            font-weight: 500;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid rgba(0,0,0,0.1);
        }
        
        .info-box {
            background: linear-gradient(135deg, #e8f4f8, #d1ecf1);
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 SVM s Landmarks</h1>
        
        <div class="content">
            <div class="canvas-container">
                <canvas id="canvas" width="600" height="500"></canvas>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>Gamma (šířka RBF kernelu):</label>
                    <input type="range" id="gammaSlider" min="0.1" max="5" step="0.1" value="1">
                    <div class="value-display" id="gammaValue">1.0</div>
                </div>
                
                <div class="control-group">
                    <label>C (regularizační parametr):</label>
                    <input type="range" id="cSlider" min="0.1" max="10" step="0.1" value="1">
                    <div class="value-display" id="cValue">1.0</div>
                </div>
                
                <div class="control-group">
                    <button class="btn-primary" onclick="addLandmarks()">Přidat landmarks</button>
                    <button class="btn-secondary" onclick="trainSVM()">Trénovat SVM</button>
                    <button class="btn-clear" onclick="clearAll()">Vymazat vše</button>
                </div>
                
                <div class="status" id="status">Klikněte na plátno pro přidání bodů</div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                Třída 1
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                Třída 2
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffe66d; border: 3px solid #333;"></div>
                Landmarks
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #95e1d3; border: 2px solid #333;"></div>
                Support vectors
            </div>
        </div>
        
        <div class="info-box">
            <strong>Jak používat:</strong><br>
            1. <strong>Levý klik</strong> - přidání bodu třídy 1 (červená)<br>
            2. <strong>Pravý klik</strong> - přidání bodu třídy 2 (tyrkysová)<br>
            3. <strong>Přidat landmarks</strong> - automaticky vybere reprezentativní body<br>
            4. <strong>Trénovat SVM</strong> - natrénuje model a zobrazí rozhodovací hranici<br>
            5. <strong>Gamma</strong> - menší hodnota = měkčí hranice, větší = ostřejší hranice<br>
            6. <strong>C</strong> - menší hodnota = více regularizace, větší = přesnější klasifikace
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // Data
        let points = [];
        let landmarks = [];
        let supportVectors = [];
        let model = null;
        let currentClass = 1;
        
        // Parameters
        let gamma = 1.0;
        let C = 1.0;
        
        // UI elements
        const gammaSlider = document.getElementById('gammaSlider');
        const cSlider = document.getElementById('cSlider');
        const gammaValue = document.getElementById('gammaValue');
        const cValue = document.getElementById('cValue');
        const status = document.getElementById('status');
        
        // Event listeners
        gammaSlider.addEventListener('input', function() {
            gamma = parseFloat(this.value);
            gammaValue.textContent = gamma.toFixed(1);
            if (model) trainSVM();
        });
        
        cSlider.addEventListener('input', function() {
            C = parseFloat(this.value);
            cValue.textContent = C.toFixed(1);
            if (model) trainSVM();
        });
        
        canvas.addEventListener('click', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            points.push({x: x, y: y, class: currentClass});
            currentClass = currentClass === 1 ? -1 : 1;
            
            updateStatus(`Přidán bod. Celkem: ${points.length} bodů`);
            draw();
        });
        
        canvas.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            points.push({x: x, y: y, class: -1});
            
            updateStatus(`Přidán bod třídy 2. Celkem: ${points.length} bodů`);
            draw();
        });
        
        function updateStatus(message) {
            status.textContent = message;
        }
        
        function addLandmarks() {
            if (points.length < 3) {
                updateStatus('Potřebujete alespoň 3 body pro landmarks');
                return;
            }
            
            // Jednoduchý algoritmus pro výběr landmarks - k-means clustering
            landmarks = [];
            const k = Math.min(5, points.length);
            
            // Náhodný výběr počátečních landmarks
            for (let i = 0; i < k; i++) {
                const randomIndex = Math.floor(Math.random() * points.length);
                landmarks.push({
                    x: points[randomIndex].x,
                    y: points[randomIndex].y
                });
            }
            
            // Několik iterací k-means
            for (let iter = 0; iter < 10; iter++) {
                const clusters = new Array(k).fill().map(() => []);
                
                // Přiřazení bodů k nejbližším landmarks
                points.forEach(point => {
                    let minDist = Infinity;
                    let bestCluster = 0;
                    
                    landmarks.forEach((landmark, idx) => {
                        const dist = Math.sqrt(
                            Math.pow(point.x - landmark.x, 2) + 
                            Math.pow(point.y - landmark.y, 2)
                        );
                        if (dist < minDist) {
                            minDist = dist;
                            bestCluster = idx;
                        }
                    });
                    
                    clusters[bestCluster].push(point);
                });
                
                // Aktualizace pozic landmarks
                landmarks.forEach((landmark, idx) => {
                    if (clusters[idx].length > 0) {
                        const sumX = clusters[idx].reduce((sum, p) => sum + p.x, 0);
                        const sumY = clusters[idx].reduce((sum, p) => sum + p.y, 0);
                        landmark.x = sumX / clusters[idx].length;
                        landmark.y = sumY / clusters[idx].length;
                    }
                });
            }
            
            updateStatus(`Vytvořeno ${landmarks.length} landmarks`);
            draw();
        }
        
        function rbfKernel(x1, y1, x2, y2, gamma) {
            const dist = Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2);
            return Math.exp(-gamma * dist);
        }
        
        function featureTransform(point) {
            // Transformace pomocí RBF kernelu s landmarks
            const features = [];
            landmarks.forEach(landmark => {
                const feature = rbfKernel(point.x, point.y, landmark.x, landmark.y, gamma);
                features.push(feature);
            });
            return features;
        }
        
        function trainSVM() {
            if (points.length < 2 || landmarks.length === 0) {
                updateStatus('Potřebujete body a landmarks pro trénování');
                return;
            }
            
            // Transformace dat pomocí RBF kernelu
            const transformedData = points.map(point => ({
                features: featureTransform(point),
                class: point.class
            }));
            
            // Jednoduchá implementace SVM (lineární v transformovaném prostoru)
            // Pro skutečnou implementaci by se použila SMO nebo jiná optimalizace
            
            // Najdeme support vectors (zjednodušeno)
            supportVectors = [];
            const margin = 0.1;
            
            points.forEach(point => {
                const features = featureTransform(point);
                let decision = 0;
                
                // Jednoduché rozhodování na základě vzdálenosti od landmarks
                features.forEach((feature, idx) => {
                    decision += feature * (point.class > 0 ? 1 : -1);
                });
                
                if (Math.abs(decision) < margin) {
                    supportVectors.push(point);
                }
            });
            
            model = {
                landmarks: [...landmarks],
                supportVectors: [...supportVectors],
                gamma: gamma,
                C: C
            };
            
            updateStatus(`Model natrénován. Support vectors: ${supportVectors.length}`);
            draw();
            drawDecisionBoundary();
        }
        
        function predict(x, y) {
            if (!model) return 0;
            
            let decision = 0;
            model.landmarks.forEach(landmark => {
                const feature = rbfKernel(x, y, landmark.x, landmark.y, model.gamma);
                decision += feature * 0.5; // Zjednodušené váhy
            });
            
            return decision > 0 ? 1 : -1;
        }
        
        function drawDecisionBoundary() {
            if (!model) return;
            
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let x = 0; x < canvas.width; x += 2) {
                for (let y = 0; y < canvas.height; y += 2) {
                    const prediction = predict(x, y);
                    const color = prediction > 0 ? [255, 107, 107, 30] : [78, 205, 196, 30];
                    
                    const index = (y * canvas.width + x) * 4;
                    data[index] = color[0];     // R
                    data[index + 1] = color[1]; // G
                    data[index + 2] = color[2]; // B
                    data[index + 3] = color[3]; // A
                    
                    // Vyplnění 2x2 bloku
                    if (x + 1 < canvas.width) {
                        const index2 = (y * canvas.width + (x + 1)) * 4;
                        data[index2] = color[0];
                        data[index2 + 1] = color[1];
                        data[index2 + 2] = color[2];
                        data[index2 + 3] = color[3];
                    }
                    if (y + 1 < canvas.height) {
                        const index3 = ((y + 1) * canvas.width + x) * 4;
                        data[index3] = color[0];
                        data[index3 + 1] = color[1];
                        data[index3 + 2] = color[2];
                        data[index3 + 3] = color[3];
                    }
                    if (x + 1 < canvas.width && y + 1 < canvas.height) {
                        const index4 = ((y + 1) * canvas.width + (x + 1)) * 4;
                        data[index4] = color[0];
                        data[index4 + 1] = color[1];
                        data[index4 + 2] = color[2];
                        data[index4 + 3] = color[3];
                    }
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            drawPoints(); // Překreslíme body nad pozadím
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (model) {
                drawDecisionBoundary();
            }
            
            drawPoints();
        }
        
        function drawPoints() {
            // Kreslení bodů
            points.forEach(point => {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 8, 0, 2 * Math.PI);
                ctx.fillStyle = point.class === 1 ? '#ff6b6b' : '#4ecdc4';
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            // Kreslení landmarks
            landmarks.forEach(landmark => {
                ctx.beginPath();
                ctx.arc(landmark.x, landmark.y, 12, 0, 2 * Math.PI);
                ctx.fillStyle = '#ffe66d';
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Krž uvnitř
                ctx.beginPath();
                ctx.moveTo(landmark.x - 6, landmark.y);
                ctx.lineTo(landmark.x + 6, landmark.y);
                ctx.moveTo(landmark.x, landmark.y - 6);
                ctx.lineTo(landmark.x, landmark.y + 6);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            // Kreslení support vectors
            supportVectors.forEach(sv => {
                ctx.beginPath();
                ctx.arc(sv.x, sv.y, 15, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(149, 225, 211, 0.3)';
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.stroke();
            });
        }
        
        function clearAll() {
            points = [];
            landmarks = [];
            supportVectors = [];
            model = null;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            updateStatus('Vše vymazáno');
        }
        
        // Počáteční kreslení
        draw();
    </script>
</body>
</html>